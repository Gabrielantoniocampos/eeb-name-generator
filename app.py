# -*- coding: utf-8 -*-
"""app

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1hKoAMUn-FThKfVMRZbU_8BMROVvw9Ddl
"""

import streamlit as st
import unicodedata
import re
import time
import random

# ==============================
# FUN√á√ïES AUXILIARES
# ==============================
def limpar_texto(texto):
    texto = unicodedata.normalize("NFKD", texto)
    texto = texto.encode("ASCII", "ignore").decode("ASCII")
    texto = texto.replace("¬∞", "")
    texto = re.sub(r"[^\w\s-]", "", texto)
    texto = re.sub(r"\s+", " ", texto)
    return texto.strip().upper()

def bot_message(texto, delay=1):
    pensamentos = [
        "ü§î Pensando...",
        "üîé Analisando...",
        "‚úçÔ∏è Preparando...",
        "üìÑ Organizando..."
    ]
    with st.chat_message("assistant"):
        with st.spinner(random.choice(pensamentos)):
            time.sleep(delay)
        st.markdown(texto)

# ==============================
# CONFIGURA√á√ÉO DA P√ÅGINA
# ==============================
st.set_page_config(
    page_title="Gerador de Nome de Documento",
    page_icon="üìÑ",
    layout="centered"
)

# Estiliza√ß√£o Customizada
st.markdown("""
    <style>
    .header-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
    }
    [data-testid="stChatMessageAvatarAssistant"] {
        background-color: #007bff !important;
    }
    [data-testid="stChatMessageAvatarUser"] {
        background-color: #333333 !important;
    }
    div.stButton > button {
        background-color: #333333 !important;
        color: white !important;
        border: none;
    }
    div.stButton > button[kind="primary"] {
        background-color: #28a745 !important;
        color: white !important;
        border: none;
    }
    </style>
""", unsafe_allow_html=True)

try:
    col_fora1, col_logo, col_fora2 = st.columns([2, 2, 2])
    with col_logo:
        st.image(
            "/content/EBB LOGO PRETO.png",
            width=180  # ajuste aqui (ex: 150‚Äì220)
        )
except:
    st.warning("‚ö†Ô∏è Logo n√£o encontrado. Verifique se o arquivo est√° na pasta do Colab.")

# Centraliza√ß√£o do t√≠tulo e subt√≠tulo via HTML
st.markdown("""
    <div style="text-align: center;">
        <h1>EEB GENERATOR NAME</h1>
        <p style="color: gray;">Diga-me os detalhes, e eu te dou o nome perfeito.</p>
    </div>
""", unsafe_allow_html=True)

st.markdown('<div class="header-container">', unsafe_allow_html=True)
st.markdown("<h1 style='text-align: center;'>EEB GENERATOR NAME</h1>", unsafe_allow_html=True)
st.markdown("<p style='text-align: center; color: gray;'>Diga-me os detalhes, e eu te dou o nome perfeito.</p>", unsafe_allow_html=True)
st.markdown('</div>', unsafe_allow_html=True)
st.markdown("---")

# ==============================
# DADOS
# ==============================
tipos_contrato = {
    "Aditivos": "ADT",
    "Cartas": "CRT",
    "Cess√£o de direitos": "CDDA",
    "Distratos": "DIS",
    "Contratos de edi√ß√£o e termos": "CE",
    "Termos": "TRM"
}

segmentos = {
    "Ensino Infantil": "EI",
    "Ensino Fundamental Anos Iniciais": "EFAI",
    "Ensino Fundamental Anos Finais": "EFAF",
    "Ensino M√©dio": "EM",
    "Ensino M√©dio Pr√© Vestibular": "EM PV"
}

selos = ["√Åtica","Scipione","Saraiva","Anglo","PH","SOMOS","Amplia","√âtico","Fibonacci","PLURALL","Rede Crist√£","Videoaulas","Pit√°goras","Mind Makers","Maxi","Farias Brito","Eduall"]
anos_series = ["1¬∞ Ano","2¬∞ Ano","3¬∞ Ano","4¬∞ Ano","5¬∞ Ano","6¬∞ Ano","7¬∞ Ano","8¬∞ Ano","9¬∞ Ano","1¬∞ S√©rie","2¬∞ S√©rie","4¬∞ S√©rie"]

# ==============================
# ESTADO E FLUXO
# ==============================
if "step" not in st.session_state:
    st.session_state.step = 0
    st.session_state.data = {}

if st.session_state.step == 0:
    with st.chat_message("assistant"):
        st.markdown("Ol√°! Vou gerar o **nome do documento** no padr√£o corporativo.")
    st.session_state.step = 1

# --- STEPS (O seu c√≥digo original continua aqui igual) ---
if st.session_state.step == 1:
    with st.chat_message("user"):
        tipo = st.selectbox("Tipo de contrato", list(tipos_contrato.keys()), key="tipo_select")
        if st.button("Confirmar", key="confirm_tipo"):
            st.session_state.data["tipo"] = tipos_contrato[tipo]
            st.session_state.step = 2
            st.rerun()

if st.session_state.step == 2:
    bot_message("Selecione o **selo**.")
    with st.chat_message("user"):
        selo = st.selectbox("Selo", selos, key="selo_select")
        if st.button("Confirmar", key="confirm_selo"):
            st.session_state.data["selo"] = limpar_texto(selo)
            st.session_state.step = 3
            st.rerun()

if st.session_state.step == 3:
    bot_message("Informe o **ano ou s√©rie**.")
    with st.chat_message("user"):
        ano = st.selectbox("Ano / S√©rie", anos_series, key="ano_select")
        if st.button("Confirmar", key="confirm_ano"):
            st.session_state.data["ano"] = limpar_texto(ano)
            st.session_state.step = 4
            st.rerun()

if st.session_state.step == 4:
    bot_message("Escolha o **segmento**.")
    with st.chat_message("user"):
        seg = st.selectbox("Segmento", list(segmentos.keys()), key="seg_select")
        if st.button("Confirmar", key="confirm_seg"):
            st.session_state.data["segmento"] = segmentos[seg]
            st.session_state.step = 5
            st.rerun()

if st.session_state.step == 5:
    bot_message("Informe o **autor**.")
    with st.chat_message("user"):
        autor = st.text_input("Autor", key="autor_input")
        if st.button("Confirmar", key="confirm_autor"):
            if autor.strip():
                st.session_state.data["autor"] = limpar_texto(autor)
                st.session_state.step = 6
                st.rerun()

if st.session_state.step == 6:
    bot_message("Informe a **obra**.")
    with st.chat_message("user"):
        obra = st.text_input("Obra", key="obra_input")
        if st.button("Confirmar", key="confirm_obra"):
            if obra.strip():
                st.session_state.data["obra"] = limpar_texto(obra)
                st.session_state.step = 7
                st.rerun()

if st.session_state.step == 7:
    bot_message("O contrato √© uma solicita√ß√£o de terceiros?")
    col1, col2 = st.columns(2)
    with col1:
        if st.button("Sim", key="terceiros_sim", type="primary", use_container_width=True):
            st.session_state.data["terceiros"] = True
            st.session_state.step = 70
            st.rerun()
    with col2:
        if st.button("N√£o", key="terceiros_nao", use_container_width=True):
            st.session_state.data["terceiros"] = False
            st.session_state.step = 8
            st.rerun()

if st.session_state.step == 70:
    bot_message("Informe o **ID da solicita√ß√£o**.")
    with st.chat_message("user"):
        id_sol = st.text_input("ID", key="id_input")
        if st.button("Confirmar ID", key="confirm_id"):
            if id_sol.strip():
                st.session_state.data["id_terceiros"] = limpar_texto(id_sol)
                st.session_state.step = 8
                st.rerun()

if st.session_state.step == 8:
    bot_message("Documento gerado com sucesso.")
    partes = [
        st.session_state.data['tipo'],
        st.session_state.data['selo'],
        st.session_state.data['autor'],
        st.session_state.data['obra'],
        st.session_state.data['ano'],
        st.session_state.data['segmento']
    ]
    if st.session_state.data.get("terceiros"):
        partes.append(st.session_state.data.get('id_terceiros'))

    resultado = " - ".join(partes)
    with st.chat_message("user"):
        st.code(resultado)

    if st.button("üîÑ Recome√ßar"):
        st.session_state.clear()
        st.rerun()
